<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>fünftersatz</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --card: #161a22;
    --accent: #00e5a0;
    --accent2: #ff4d6d;
    --accent3: #7b6cff;
    --text: #edf0f4;
    --muted: #6b7280;
    --border: rgba(255,255,255,0.07);
  }

  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  body { background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; min-height:100vh; }
  .shell { max-width:480px; margin:0 auto; min-height:100vh; display:flex; flex-direction:column; }
  .screen { display:none; flex-direction:column; flex:1; animation:fadeUp .35s ease; }
  .screen.active { display:flex; }
  @keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }

  /* ── LOGO ── */
  .logo { font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:2px; color:var(--accent); }
  .topbar { padding:28px 28px 0; display:flex; align-items:center; justify-content:space-between; }
  .back-btn { display:flex; align-items:center; gap:8px; font-size:14px; color:var(--muted); cursor:pointer; padding:8px 0; }

  /* ── HERO ── */
  .hero { padding:36px 28px 24px; }
  .hero-eyebrow { font-size:12px; letter-spacing:3px; text-transform:uppercase; color:var(--muted); margin-bottom:14px; }
  .hero-title { font-family:'Bebas Neue',sans-serif; font-size:58px; line-height:.95; letter-spacing:1px; margin-bottom:16px; }
  .hero-title .hl { color:var(--accent); }
  .hero-sub { font-size:16px; color:var(--muted); font-weight:300; line-height:1.6; }

  /* ── SECTION LABEL ── */
  .section-label { font-size:12px; letter-spacing:3px; text-transform:uppercase; color:var(--muted); padding:32px 28px 16px; }

  /* ── ONBOARDING ── */
  .onboarding-wrap { flex:1; display:flex; flex-direction:column; padding:0 28px 40px; }

  .progress-steps { display:flex; gap:6px; margin-bottom:36px; }
  .step-dot { flex:1; height:3px; border-radius:3px; background:rgba(255,255,255,.08); transition:.3s; }
  .step-dot.done { background:var(--accent); }
  .step-dot.active { background:var(--accent); opacity:.5; }

  .step-block { display:none; flex-direction:column; flex:1; animation:fadeUp .3s ease; }
  .step-block.active { display:flex; }

  .step-eyebrow { font-size:11px; letter-spacing:3px; text-transform:uppercase; color:var(--accent); margin-bottom:10px; }
  .step-title { font-family:'Bebas Neue',sans-serif; font-size:40px; line-height:1; margin-bottom:8px; }
  .step-sub { font-size:15px; color:var(--muted); font-weight:300; line-height:1.6; margin-bottom:32px; }

  /* Input */
  .input-field {
    background:var(--card); border:2px solid var(--border); border-radius:16px;
    padding:18px 20px; font-size:16px; color:var(--text); width:100%;
    font-family:'DM Sans',sans-serif; outline:none; transition:.2s; margin-bottom:16px;
  }
  .input-field:focus { border-color:var(--accent); }
  .input-field::placeholder { color:var(--muted); }

  /* Option grid */
  .option-grid { display:flex; flex-direction:column; gap:12px; margin-bottom:16px; }
  .option-grid.two-col { display:grid; grid-template-columns:1fr 1fr; gap:12px; }

  .option-btn {
    background:var(--card); border:2px solid var(--border); border-radius:16px;
    padding:18px 20px; font-size:15px; cursor:pointer; transition:.2s;
    font-family:'DM Sans',sans-serif; color:var(--text); text-align:left;
    display:flex; align-items:center; gap:14px;
  }
  .option-btn:hover { border-color:rgba(255,255,255,.15); }
  .option-btn.selected { border-color:var(--accent); color:var(--accent); background:rgba(0,229,160,.06); }
  .option-btn .opt-icon { width:36px; height:36px; border-radius:10px; display:flex; align-items:center; justify-content:center; flex-shrink:0; background:rgba(255,255,255,.05); }
  .option-btn.selected .opt-icon { background:rgba(0,229,160,.12); }
  .option-label { font-size:15px; font-weight:500; }
  .option-sub { font-size:12px; color:var(--muted); margin-top:2px; }
  .option-btn.selected .option-sub { color:rgba(0,229,160,.7); }

  /* TTR Slider */
  .ttr-display { font-family:'Bebas Neue',sans-serif; font-size:56px; color:var(--accent); margin-bottom:8px; }
  .ttr-label { font-size:13px; color:var(--muted); margin-bottom:24px; }
  .slider-wrap { position:relative; margin-bottom:32px; }
  input[type=range] {
    width:100%; -webkit-appearance:none; height:4px;
    background:rgba(255,255,255,.08); border-radius:4px; outline:none;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance:none; width:24px; height:24px; border-radius:50%;
    background:var(--accent); cursor:pointer; box-shadow:0 0 12px rgba(0,229,160,.4);
  }
  .slider-labels { display:flex; justify-content:space-between; font-size:12px; color:var(--muted); margin-top:10px; }

  /* Stärken/Schwächen Tags */
  .tag-grid { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:16px; }
  .tag-btn {
    background:var(--card); border:2px solid var(--border); border-radius:100px;
    padding:11px 18px; font-size:14px; cursor:pointer; transition:.2s;
    font-family:'DM Sans',sans-serif; color:var(--muted);
  }
  .tag-btn:hover { border-color:rgba(255,255,255,.15); color:var(--text); }
  .tag-btn.selected-strength { border-color:var(--accent); color:var(--accent); background:rgba(0,229,160,.06); }
  .tag-btn.selected-weakness { border-color:var(--accent2); color:var(--accent2); background:rgba(255,77,109,.06); }

  .tag-hint { font-size:13px; color:#ccd; margin-bottom:20px; display:flex; gap:14px; flex-wrap:wrap; background:rgba(255,255,255,.05); border-radius:12px; padding:12px 16px; border:1px solid rgba(255,255,255,.08); }
  .tag-hint span { display:flex; align-items:center; gap:6px; }
  .hint-dot { width:8px; height:8px; border-radius:50%; }

  /* Next button */
  .next-btn {
    width:100%; background:var(--accent); border:none; border-radius:16px;
    padding:20px; font-size:17px; font-weight:500; cursor:pointer; transition:.2s;
    font-family:'DM Sans',sans-serif; color:#0d0f14; margin-top:auto;
    display:flex; align-items:center; justify-content:center; gap:10px;
  }
  .next-btn:hover { opacity:.9; transform:translateY(-1px); }
  .next-btn:disabled { opacity:.3; cursor:not-allowed; transform:none; }

  /* ── MAIN APP ── */
  .mood-row { display:flex; gap:12px; padding:0 28px; overflow-x:auto; scrollbar-width:none; }
  .mood-row::-webkit-scrollbar { display:none; }
  .mood-chip {
    flex-shrink:0; background:var(--card); border:2px solid var(--border);
    border-radius:100px; padding:13px 22px; font-size:15px; cursor:pointer;
    transition:all .2s; white-space:nowrap; display:flex; align-items:center; gap:8px;
  }
  .mood-chip.selected, .mood-chip:hover { border-color:var(--accent); color:var(--accent); background:rgba(0,229,160,.08); }

  .main-cards { padding:0 28px; display:flex; flex-direction:column; gap:16px; }
  .main-card {
    background:var(--card); border:2px solid var(--border); border-radius:22px;
    padding:28px; cursor:pointer; transition:all .25s;
  }
  .main-card:hover { transform:translateY(-2px); border-color:rgba(255,255,255,.13); }
  .card-top { display:flex; align-items:center; gap:16px; margin-bottom:16px; }
  .card-icon { width:52px; height:52px; border-radius:16px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
  .card-tag { font-size:11px; letter-spacing:2px; text-transform:uppercase; padding:5px 12px; border-radius:100px; }
  .main-card h3 { font-size:20px; font-weight:500; margin-bottom:8px; }
  .main-card p { font-size:15px; color:var(--muted); line-height:1.6; font-weight:300; }

  /* PRO badge */
  .pro-badge {
    font-size:10px; letter-spacing:2px; text-transform:uppercase;
    background:linear-gradient(135deg, #f5a623, #ff4d6d);
    color:white; padding:3px 10px; border-radius:100px; margin-left:8px;
    font-weight:500;
  }

  /* Video upload card */
  .video-card {
    background:linear-gradient(145deg, #1a1510, #120f0a);
    border:2px solid rgba(245,166,35,.15); border-radius:22px;
    padding:28px; position:relative; overflow:hidden;
  }
  .video-card::after {
    content:''; position:absolute; bottom:-30px; right:-30px;
    width:120px; height:120px;
    background:radial-gradient(circle, rgba(245,166,35,.1), transparent 70%);
    border-radius:50%;
  }
  .video-upload-area {
    border:2px dashed rgba(245,166,35,.25); border-radius:16px;
    padding:32px; text-align:center; margin-top:16px; cursor:pointer; transition:.2s;
  }
  .video-upload-area:hover { border-color:rgba(245,166,35,.5); background:rgba(245,166,35,.04); }
  .upload-icon { margin-bottom:12px; opacity:.6; }
  .upload-text { font-size:15px; color:var(--muted); line-height:1.6; }
  .upload-text strong { color:#f5a623; }

  /* MENTOR */
  .mentor-body { padding:28px; flex:1; display:flex; flex-direction:column; }
  .mentor-avatar {
    width:72px; height:72px; border-radius:22px;
    background:linear-gradient(135deg,var(--accent3),var(--accent));
    display:flex; align-items:center; justify-content:center;
    margin-bottom:24px; box-shadow:0 0 48px rgba(123,108,255,.25);
  }
  .bubble {
    background:var(--card); border:2px solid var(--border);
    border-radius:22px 22px 22px 6px; padding:22px 24px;
    font-size:16px; line-height:1.7; font-weight:300; margin-bottom:20px;
  }
  .bubble strong { color:var(--accent); font-weight:500; }
  .reply-grid { display:flex; flex-direction:column; gap:12px; }
  .reply-btn {
    background:var(--card); border:2px solid var(--border); border-radius:16px;
    padding:18px 22px; font-size:15px; cursor:pointer; transition:.2s;
    font-family:'DM Sans',sans-serif; color:var(--text); text-align:left;
    display:flex; align-items:center; gap:14px;
  }
  .reply-btn:hover { border-color:var(--accent3); color:var(--accent3); background:rgba(123,108,255,.08); }
  .mentor-response {
    background:rgba(123,108,255,.08); border:2px solid rgba(123,108,255,.2);
    border-radius:22px 22px 6px 22px; padding:22px 24px;
    font-size:16px; line-height:1.7; font-weight:300;
    margin-top:20px; display:none; animation:fadeUp .4s ease;
  }

  /* SOUND */
  .player-card {
    margin:0 28px; background:linear-gradient(145deg,#1c1e2e,#13151f);
    border:2px solid rgba(123,108,255,.18); border-radius:26px; padding:32px 28px;
  }
  .wave-viz { display:flex; align-items:center; gap:4px; height:48px; margin-bottom:24px; }
  .wave-bar { flex:1; border-radius:4px; background:var(--accent3); opacity:.4; animation:wave 1.3s ease-in-out infinite; }
  .wave-bar:nth-child(2n){animation-delay:.15s}
  .wave-bar:nth-child(3n){animation-delay:.35s}
  @keyframes wave{0%,100%{height:15%;opacity:.2}50%{height:90%;opacity:.7}}
  .player-track-name { font-size:20px; font-weight:500; margin-bottom:6px; }
  .player-track-sub { font-size:14px; color:var(--muted); margin-bottom:26px; }
  .player-controls { display:flex; align-items:center; gap:20px; }
  .play-btn {
    width:60px; height:60px; border-radius:50%; background:var(--accent3); border:none; cursor:pointer;
    display:flex; align-items:center; justify-content:center; flex-shrink:0;
    box-shadow:0 0 30px rgba(123,108,255,.4); transition:.2s;
  }
  .play-btn:hover { transform:scale(1.06); }
  .progress-wrap { flex:1; }
  .progress-time { font-size:13px; color:var(--muted); margin-bottom:10px; }
  .progress-bar { height:5px; background:rgba(255,255,255,.08); border-radius:5px; overflow:hidden; }
  .progress-fill { height:100%; width:0%; background:linear-gradient(90deg,var(--accent3),var(--accent)); border-radius:5px; transition:.3s; }

  .beat-list { padding:0 28px; display:flex; flex-direction:column; gap:12px; }
  .beat-item {
    background:var(--card); border:2px solid var(--border); border-radius:18px;
    padding:20px 22px; display:flex; align-items:center; gap:18px; cursor:pointer; transition:.2s;
  }
  .beat-item:hover { border-color:rgba(123,108,255,.35); }
  .beat-item.active { border-color:var(--accent3); background:rgba(123,108,255,.07); }
  .beat-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
  .beat-name { font-size:16px; font-weight:500; }
  .beat-desc { font-size:13px; color:var(--muted); margin-top:3px; }
  .beat-hz { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:1px; margin-left:auto; }

  .aff-card {
    margin:0 28px; background:linear-gradient(145deg,#141f1a,#0f1712);
    border:2px solid rgba(0,229,160,.12); border-radius:26px; padding:32px 28px;
  }
  .aff-text {
    font-family:'Bebas Neue',sans-serif; font-size:28px; line-height:1.2;
    letter-spacing:1px; color:var(--accent); min-height:80px; margin-bottom:24px; transition:opacity .3s;
  }
  .aff-buttons { display:flex; flex-direction:column; gap:12px; }
  .aff-btn {
    background:rgba(255,255,255,.04); border:2px solid var(--border); border-radius:14px;
    padding:16px 22px; font-size:15px; cursor:pointer; transition:.2s;
    font-family:'DM Sans',sans-serif; color:var(--text); text-align:left;
    display:flex; align-items:center; gap:14px;
  }
  .aff-btn:hover { border-color:var(--accent); color:var(--accent); background:rgba(0,229,160,.06); }
  .rec-btn { color:var(--accent2); border-color:rgba(255,77,109,.25); background:rgba(255,77,109,.06); }
  .rec-btn:hover { border-color:var(--accent2); background:rgba(255,77,109,.12); }
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}

  /* ANALYSE */
  .stat-card { margin:0 28px 16px; background:var(--card); border:2px solid var(--border); border-radius:22px; padding:26px 28px; }
  .stat-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:20px; }
  .stat-name { font-size:18px; font-weight:500; }
  .stat-sub { font-size:13px; color:var(--muted); margin-top:4px; }
  .stat-badge { font-size:11px; letter-spacing:1px; text-transform:uppercase; padding:5px 14px; border-radius:100px; }
  .badge-warn { background:rgba(255,77,109,.1); color:var(--accent2); }
  .badge-good { background:rgba(0,229,160,.1); color:var(--accent); }
  .bar-row { display:flex; align-items:center; gap:14px; margin-bottom:12px; }
  .bar-label { font-size:13px; color:var(--muted); width:110px; flex-shrink:0; }
  .bar-track { flex:1; height:8px; background:rgba(255,255,255,.06); border-radius:8px; overflow:hidden; }
  .bar-fill { height:100%; border-radius:8px; width:0%; transition:width 1.2s cubic-bezier(.16,1,.3,1); }
  .bar-pct { font-size:14px; font-weight:500; width:36px; text-align:right; }
  .insight-card { margin:0 28px; background:rgba(0,229,160,.05); border:2px solid rgba(0,229,160,.12); border-radius:22px; padding:26px 28px; }
  .insight-label { font-size:11px; letter-spacing:2px; text-transform:uppercase; color:var(--accent); margin-bottom:12px; display:flex; align-items:center; gap:8px; }
  .insight-card p { font-size:15px; color:var(--text); line-height:1.7; font-weight:300; }
  .insight-card strong { color:var(--accent); font-weight:500; }

  /* NAV */
  .bottom-nav {
    position:sticky; bottom:0;
    background:rgba(13,15,20,.97); backdrop-filter:blur(20px);
    border-top:1px solid var(--border);
    display:flex; padding:14px 0 28px;
  }
  .nav-item { flex:1; display:flex; flex-direction:column; align-items:center; gap:6px; cursor:pointer; transition:.2s; padding:6px 0; }
  .nav-item svg { opacity:.3; transition:.2s; }
  .nav-label { font-size:11px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); transition:.2s; }
  .nav-item.active svg { opacity:1; }
  .nav-item.active .nav-label { color:var(--accent); }

  /* Profile summary pill */
  .profile-pill {
    margin:0 28px 4px;
    background:rgba(0,229,160,.06); border:1.5px solid rgba(0,229,160,.12);
    border-radius:14px; padding:14px 18px;
    display:flex; align-items:center; gap:12px;
  }
  .profile-pill-avatar {
    width:36px; height:36px; border-radius:10px;
    background:linear-gradient(135deg,var(--accent3),var(--accent));
    display:flex; align-items:center; justify-content:center; flex-shrink:0;
    font-size:14px; font-weight:600; color:white;
  }
  .profile-pill-info { flex:1; }
  .profile-pill-name { font-size:14px; font-weight:500; }
  .profile-pill-tags { font-size:12px; color:var(--muted); margin-top:2px; }
  .profile-pill-ttr { font-family:'Bebas Neue',sans-serif; font-size:22px; color:var(--accent); letter-spacing:1px; }
</style>
</head>
<body>
<div class="shell">

  <!-- ════ ONBOARDING ════ -->
  <div class="screen active" id="screen-onboarding">
    <div class="topbar">
      <div class="logo">fünftersatz</div>
      <div style="font-size:13px;color:var(--muted)" id="stepCounter">1 / 6</div>
    </div>
    <div style="padding:20px 28px 0">
      <div class="progress-steps">
        <div class="step-dot active" id="dot-0"></div>
        <div class="step-dot" id="dot-1"></div>
        <div class="step-dot" id="dot-2"></div>
        <div class="step-dot" id="dot-3"></div>
        <div class="step-dot" id="dot-4"></div>
        <div class="step-dot" id="dot-5"></div>
      </div>
    </div>

    <div class="onboarding-wrap">

      <!-- STEP 0: Name -->
      <div class="step-block active" id="step-0">
        <div class="step-eyebrow">Schritt 1</div>
        <div class="step-title">WER BIST<br>DU?</div>
        <div class="step-sub">Damit dein Mentor dich wirklich kennt – fangen wir von vorne an.</div>
        <input class="input-field" id="input-name" type="text" placeholder="Dein Vorname" oninput="checkStep0()">
        <div style="margin-top:8px">
          <div style="font-size:13px;color:var(--muted);margin-bottom:12px">Wie lange spielst du schon?</div>
          <div class="option-grid two-col">
            <div class="option-btn" onclick="selectOne(this,'years')">
              <div><div class="option-label">1–3 Jahre</div></div>
            </div>
            <div class="option-btn" onclick="selectOne(this,'years')">
              <div><div class="option-label">4–8 Jahre</div></div>
            </div>
            <div class="option-btn" onclick="selectOne(this,'years')">
              <div><div class="option-label">9–15 Jahre</div></div>
            </div>
            <div class="option-btn" onclick="selectOne(this,'years')">
              <div><div class="option-label">15+ Jahre</div></div>
            </div>
          </div>
        </div>
        <button class="next-btn" id="btn-0" onclick="nextStep(1)" disabled>
          Weiter
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>

      <!-- STEP 1: Spielstil -->
      <div class="step-block" id="step-1">
        <div class="step-eyebrow">Schritt 2</div>
        <div class="step-title">DEIN<br>SPIELSTIL</div>
        <div class="step-sub">Wie würdest du dein Spiel beschreiben?</div>
        <div class="option-grid">
          <div class="option-btn" onclick="selectOne(this,'style')">
            <div class="opt-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
            </div>
            <div><div class="option-label">Offensiv</div><div class="option-sub">Topspin, Angriff, Tempo</div></div>
          </div>
          <div class="option-btn" onclick="selectOne(this,'style')">
            <div class="opt-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div><div class="option-label">Defensiv</div><div class="option-sub">Abwehr, Kontrolle, Geduld</div></div>
          </div>
          <div class="option-btn" onclick="selectOne(this,'style')">
            <div class="opt-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            </div>
            <div><div class="option-label">Allround</div><div class="option-sub">Vielseitig, anpassungsfähig</div></div>
          </div>
          <div class="option-btn" onclick="selectOne(this,'style')">
            <div class="opt-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></svg>
            </div>
            <div><div class="option-label">Störspieler</div><div class="option-sub">Noppe, Anti, Variation</div></div>
          </div>
        </div>
        <button class="next-btn" onclick="nextStep(2)">
          Weiter
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>

      <!-- STEP 2: Material -->
      <div class="step-block" id="step-2">
        <div class="step-eyebrow">Schritt 3</div>
        <div class="step-title">DEIN<br>MATERIAL</div>
        <div class="step-sub">Welche Beläge spielst du? Mehrfachauswahl möglich.</div>
        <div class="option-grid">
          <div class="option-btn" onclick="toggleMulti(this,'material')">
            <div><div class="option-label">Vorhand: Glattbelag</div><div class="option-sub">Standard Topspin-Belag</div></div>
          </div>
          <div class="option-btn" onclick="toggleMulti(this,'material')">
            <div><div class="option-label">Rückhand: Lange Noppe</div><div class="option-sub">Störeffekt, Konterspiel</div></div>
          </div>
          <div class="option-btn" onclick="toggleMulti(this,'material')">
            <div><div class="option-label">Kurze Noppe</div><div class="option-sub">Schnelles Konter, wenig Effekt</div></div>
          </div>
          <div class="option-btn" onclick="toggleMulti(this,'material')">
            <div><div class="option-label">Anti-Topspin</div><div class="option-sub">Effektumkehr, Abwehr</div></div>
          </div>
        </div>
        <button class="next-btn" onclick="nextStep(3)">
          Weiter
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>

      <!-- STEP 3: TTR -->
      <div class="step-block" id="step-3">
        <div class="step-eyebrow">Schritt 4</div>
        <div class="step-title">DEIN<br>NIVEAU</div>
        <div class="step-sub">TTR-Wert oder ungefähre Spielklasse – damit dein Mentor auf deinem Level spricht.</div>
        <div class="ttr-display" id="ttrDisplay">1200</div>
        <div class="ttr-label" id="ttrClassLabel">Bezirksliga · Solider Vereinsspieler</div>
        <div class="slider-wrap">
          <input type="range" min="500" max="2800" value="1200" step="10" oninput="updateTTR(this.value)">
          <div class="slider-labels">
            <span>Einsteiger</span>
            <span>Bezirk</span>
            <span>Verband</span>
            <span>Bundesliga</span>
          </div>
        </div>
        <button class="next-btn" onclick="nextStep(4)">
          Weiter
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>

      <!-- STEP 4: Stärken & Schwächen -->
      <div class="step-block" id="step-4">
        <div class="step-eyebrow">Schritt 5</div>
        <div class="step-title">STÄRKEN &<br>SCHWÄCHEN</div>
        <div class="step-sub">Tippe auf deine Stärken und Schwächen. Sei ehrlich – hier schaut nur dein Mentor.</div>
        <div class="tag-hint">
          <span><div class="hint-dot" style="background:var(--accent)"></div> Stärke (1x tippen)</span>
          <span><div class="hint-dot" style="background:var(--accent2)"></div> Schwäche (2x tippen)</span>
          <span>Neutral (3x tippen)</span>
        </div>
        <div class="tag-grid">
          <div class="tag-btn" onclick="cycleTag(this)">Aufschlag</div>
          <div class="tag-btn" onclick="cycleTag(this)">Störspiel</div>
          <div class="tag-btn" onclick="cycleTag(this)">Noppen-Kontrolle</div>
          <div class="tag-btn" onclick="cycleTag(this)">VH-Abschluss</div>
          <div class="tag-btn" onclick="cycleTag(this)">Rückhand-Topspin</div>
          <div class="tag-btn" onclick="cycleTag(this)">Routine bei Führung</div>
          <div class="tag-btn" onclick="cycleTag(this)">Footwork</div>
          <div class="tag-btn" onclick="cycleTag(this)">Aufschlag-Rückspiel</div>
          <div class="tag-btn" onclick="cycleTag(this)">Konstanz</div>
          <div class="tag-btn" onclick="cycleTag(this)">Platzierung</div>
          <div class="tag-btn" onclick="cycleTag(this)">Nervenstärke</div>
          <div class="tag-btn" onclick="cycleTag(this)">Schnellangriff</div>
        </div>
        <button class="next-btn" onclick="nextStep(5)">
          Weiter
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>

      <!-- STEP 5: Mentales Ziel -->
      <div class="step-block" id="step-5">
        <div class="step-eyebrow">Schritt 6</div>
        <div class="step-title">WAS WILLST<br>DU <span style="color:var(--accent)">ERREICHEN?</span></div>
        <div class="step-sub">Dein mentales Hauptziel für die nächsten Wochen.</div>
        <div class="option-grid">
          <div class="option-btn" onclick="selectOne(this,'goal')">
            <div><div class="option-label">Ruhiger unter Druck</div><div class="option-sub">Enge Spielstände meistern</div></div>
          </div>
          <div class="option-btn" onclick="selectOne(this,'goal')">
            <div><div class="option-label">Führungen ausbauen</div><div class="option-sub">Nicht mehr zittern bei 8:6</div></div>
          </div>
          <div class="option-btn" onclick="selectOne(this,'goal')">
            <div><div class="option-label">Konstanter werden</div><div class="option-sub">Weniger Formschwankungen</div></div>
          </div>
          <div class="option-btn" onclick="selectOne(this,'goal')">
            <div><div class="option-label">TTR steigern</div><div class="option-sub">Nächste Spielklasse erreichen</div></div>
          </div>
        </div>
        <button class="next-btn" onclick="finishOnboarding()">
          Los geht's
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>

    </div>
  </div>

  <!-- ════ HOME ════ -->
  <div class="screen" id="screen-home">
    <div class="topbar">
      <div class="logo">fünftersatz</div>
      <div style="font-size:13px;color:var(--muted);display:flex;align-items:center;gap:6px">
        <div style="width:7px;height:7px;border-radius:50%;background:var(--accent);animation:pulse 2s infinite"></div>
        7 Tage
      </div>
    </div>

    <div class="hero">
      <div class="hero-eyebrow" id="home-greeting">Guten Abend</div>
      <div class="hero-title">MENTAL<br><span class="hl">STÄRKER</span><br>SPIELEN</div>
      <div class="hero-sub">Dein persönlicher KI-Mentor für den Kopf im Tischtennis.</div>
    </div>

    <!-- Profile Pill -->
    <div class="profile-pill" id="profile-pill">
      <div class="profile-pill-avatar" id="pill-avatar">?</div>
      <div class="profile-pill-info">
        <div class="profile-pill-name" id="pill-name">Spielerprofil</div>
        <div class="profile-pill-tags" id="pill-tags">Störspieler · Lange Noppe</div>
      </div>
      <div class="profile-pill-ttr" id="pill-ttr">1200</div>
    </div>

    <div class="section-label">Wie geht's dir gerade?</div>
    <div class="mood-row">
      <div class="mood-chip" onclick="selectMood(this)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        Fokussiert
      </div>
      <div class="mood-chip" onclick="selectMood(this)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        Unter Druck
      </div>
      <div class="mood-chip" onclick="selectMood(this)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="8" y1="15" x2="16" y2="15"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        Müde
      </div>
      <div class="mood-chip" onclick="selectMood(this)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 15h8"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
        Nervös
      </div>
    </div>

    <div class="section-label">Was möchtest du tun?</div>
    <div class="main-cards">
      <div class="main-card" onclick="goTo('screen-mentor')">
        <div class="card-top">
          <div class="card-icon" style="background:rgba(123,108,255,.12)">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#7b6cff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.44-4.14Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.44-4.14Z"/></svg>
          </div>
          <div class="card-tag" style="background:rgba(123,108,255,.1);color:#7b6cff">KI Mentor</div>
        </div>
        <h3>Coaching & Analyse</h3>
        <p>Dein Mentor kennt dein Störspiel – und weiß wo der VH-Abschluss noch fehlt.</p>
      </div>

      <div class="main-card" onclick="goTo('screen-sound')">
        <div class="card-top">
          <div class="card-icon" style="background:rgba(0,229,160,.12)">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3"/></svg>
          </div>
          <div class="card-tag" style="background:rgba(0,229,160,.1);color:var(--accent)">Sound Zone</div>
        </div>
        <h3>Binaural Beats & Affirmationen</h3>
        <p>Fokus-Frequenzen und deine persönlichen Mantras.</p>
      </div>

      <div class="main-card" onclick="goTo('screen-analyse')">
        <div class="card-top">
          <div class="card-icon" style="background:rgba(255,77,109,.12)">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="var(--accent2)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/><line x1="2" y1="20" x2="22" y2="20"/></svg>
          </div>
          <div class="card-tag" style="background:rgba(255,77,109,.1);color:var(--accent2)">Analyse</div>
        </div>
        <h3>Deine Muster</h3>
        <p>8 Matches ausgewertet – ein klares Muster gefunden.</p>
      </div>

      <!-- PRO: Video Analyse -->
      <div class="video-card">
        <div class="card-top" style="margin-bottom:8px">
          <div class="card-icon" style="background:rgba(245,166,35,.12)">
            <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#f5a623" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
          </div>
          <div>
            <div style="display:flex;align-items:center;gap:8px">
              <span style="font-size:11px;letter-spacing:2px;text-transform:uppercase;color:#f5a623">Video-Analyse</span>
              <span class="pro-badge">PRO</span>
            </div>
          </div>
        </div>
        <h3 style="margin-bottom:8px">Match-Video hochladen</h3>
        <p style="color:var(--muted);font-size:15px;line-height:1.6;font-weight:300;margin-bottom:0">Die KI analysiert dein Spiel – Technik, Taktik, Körpersprache. Kommt bald.</p>
        <div class="video-upload-area">
          <div class="upload-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#f5a623" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          </div>
          <div class="upload-text"><strong>Video hier ablegen</strong><br>oder tippen zum Auswählen<br><span style="font-size:12px;opacity:.6">MP4, MOV · max. 500 MB</span></div>
        </div>
      </div>

    </div>
    <div style="height:28px"></div>
  </div>

  <!-- ════ MENTOR ════ -->
  <div class="screen" id="screen-mentor" style="display:none;flex-direction:column;height:100vh;">
    <div class="topbar" style="flex-shrink:0;">
      <div class="back-btn" onclick="goTo('screen-home')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        Zurück
      </div>
      <div class="logo" style="font-size:18px">fünftersatz</div>
      <div style="width:70px"></div>
    </div>

    <!-- Chat feed -->
    <div id="chat-messages" style="flex:1;overflow-y:auto;padding:20px 24px;display:flex;flex-direction:column;gap:16px;"></div>

    <!-- Quick replies -->
    <div id="quick-replies" style="padding:0 24px 14px;display:flex;flex-direction:column;gap:10px;flex-shrink:0;">
      <button class="reply-btn" onclick="sendQuick('Der VH-Abschluss lässt mich nicht los')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
        VH-Abschluss fehlt mir noch
      </button>
      <button class="reply-btn" onclick="sendQuick('Ich verliere immer wenn ich im letzten Satz führe')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        Bei Führung werde ich hektisch
      </button>
      <button class="reply-btn" onclick="sendQuick('Gegner durchschauen mein Noppenspiel zunehmend')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Gegner lesen mein Noppenspiel
      </button>
    </div>

    <!-- Input bar -->
    <div style="padding:12px 20px 32px;border-top:1px solid var(--border);background:var(--bg);display:flex;gap:12px;align-items:flex-end;flex-shrink:0;">
      <textarea id="chat-input"
        placeholder="Schreib deinem Mentor..."
        rows="1"
        oninput="autoResize(this)"
        onkeydown="handleKey(event)"
        style="flex:1;background:var(--card);border:2px solid var(--border);border-radius:16px;padding:14px 18px;font-size:15px;color:var(--text);font-family:'DM Sans',sans-serif;outline:none;resize:none;line-height:1.5;transition:.2s;max-height:120px;"
      ></textarea>
      <button onclick="sendMessage()" id="send-btn"
        style="width:50px;height:50px;border-radius:50%;background:var(--accent3);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.2s;box-shadow:0 0 20px rgba(123,108,255,.3);">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      </button>
    </div>
  </div>

  <!-- ════ SOUND ════ -->
  <div class="screen" id="screen-sound">
    <div class="topbar">
      <div class="back-btn" onclick="goTo('screen-home')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        Zurück
      </div>
      <div class="logo" style="font-size:18px">fünftersatz</div>
      <div style="width:70px"></div>
    </div>
    <div class="hero" style="padding-bottom:20px">
      <div class="hero-eyebrow">Binaural Beats</div>
      <div class="hero-title" style="font-size:44px">FREQUENZEN<br>FÜR <span style="color:var(--accent3)">DEINEN FLOW</span></div>
    </div>
    <div class="player-card">
      <div class="wave-viz">
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
        <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
      </div>
      <div class="player-track-name" id="trackName">Focus Alpha · 10 Hz</div>
      <div class="player-track-sub" id="trackSub">Ruhige Konzentration · Ideal vor dem Match</div>
      <div class="player-controls">
        <button class="play-btn" onclick="togglePlay()" id="playBtn">
          <svg id="playIcon" width="22" height="22" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="1.5"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        </button>
        <div class="progress-wrap">
          <div class="progress-time" id="progressTime">0:00 / 20:00</div>
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        </div>
      </div>
    </div>
    <div class="section-label">Frequenz wählen</div>
    <div class="beat-list">
      <div class="beat-item active" onclick="selectBeat(this,'Focus Alpha · 10 Hz','Ruhige Konzentration · Vor dem Match')">
        <div class="beat-dot" style="background:#7b6cff"></div>
        <div><div class="beat-name">Focus Alpha</div><div class="beat-desc">Ruhige Konzentration · Vor dem Match</div></div>
        <div class="beat-hz" style="color:#7b6cff">10 Hz</div>
      </div>
      <div class="beat-item" onclick="selectBeat(this,'Deep Flow · 6 Hz','Theta-Wellen · Visualisierung & Intuition')">
        <div class="beat-dot" style="background:var(--accent)"></div>
        <div><div class="beat-name">Deep Flow</div><div class="beat-desc">Visualisierung & Intuition</div></div>
        <div class="beat-hz" style="color:var(--accent)">6 Hz</div>
      </div>
      <div class="beat-item" onclick="selectBeat(this,'Power Up · 20 Hz','Beta-Aktivierung · Energie & Reaktion')">
        <div class="beat-dot" style="background:var(--accent2)"></div>
        <div><div class="beat-name">Power Up</div><div class="beat-desc">Energie & Reaktionsschnelle</div></div>
        <div class="beat-hz" style="color:var(--accent2)">20 Hz</div>
      </div>
      <div class="beat-item" onclick="selectBeat(this,'Reset · 4 Hz','Delta-Entspannung · Nach dem Match')">
        <div class="beat-dot" style="background:#f5a623"></div>
        <div><div class="beat-name">Reset</div><div class="beat-desc">Entspannung · Nach dem Match</div></div>
        <div class="beat-hz" style="color:#f5a623">4 Hz</div>
      </div>
    </div>
    <div class="section-label">Affirmationen</div>
    <div class="aff-card">
      <div class="aff-text" id="affText">"ICH SPIELE DEN BALL – NICHT DAS ERGEBNIS."</div>
      <div class="aff-buttons">
        <button class="aff-btn" onclick="nextAff()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-5"/></svg>
          Nächste Affirmation
        </button>
        <button class="aff-btn rec-btn" id="recBtn" onclick="toggleRec()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
          Eigenen Satz einsprechen
        </button>
      </div>
    </div>
    <div style="height:28px"></div>
  </div>

  <!-- ════ ANALYSE ════ -->
  <div class="screen" id="screen-analyse">
    <div class="topbar">
      <div class="back-btn" onclick="goTo('screen-home')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
        Zurück
      </div>
      <div class="logo" style="font-size:18px">fünftersatz</div>
      <div style="width:70px"></div>
    </div>
    <div class="hero" style="padding-bottom:20px">
      <div class="hero-eyebrow">Letzte 8 Matches</div>
      <div class="hero-title" style="font-size:44px">DEINE<br><span class="hl">MUSTER</span></div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div><div class="stat-name">VH-Abschluss nach Vorspiel</div><div class="stat-sub">Nach 3+ Noppen-Bällen</div></div>
        <div class="stat-badge badge-warn">Schwäche</div>
      </div>
      <div class="bar-row">
        <div class="bar-label">Erfolgsquote</div>
        <div class="bar-track"><div class="bar-fill" style="background:var(--accent2)" data-w="31"></div></div>
        <div class="bar-pct" style="color:var(--accent2)">31%</div>
      </div>
      <div class="bar-row">
        <div class="bar-label">Ø Störspieler</div>
        <div class="bar-track"><div class="bar-fill" style="background:var(--muted)" data-w="58"></div></div>
        <div class="bar-pct" style="color:var(--muted)">58%</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div><div class="stat-name">Störspiel-Effektivität</div><div class="stat-sub">Erzwungene Fehler durch Noppe</div></div>
        <div class="stat-badge badge-good">Stärke</div>
      </div>
      <div class="bar-row">
        <div class="bar-label">Dein Wert</div>
        <div class="bar-track"><div class="bar-fill" style="background:var(--accent)" data-w="74"></div></div>
        <div class="bar-pct" style="color:var(--accent)">74%</div>
      </div>
      <div class="bar-row">
        <div class="bar-label">Ø Störspieler</div>
        <div class="bar-track"><div class="bar-fill" style="background:var(--muted)" data-w="52"></div></div>
        <div class="bar-pct" style="color:var(--muted)">52%</div>
      </div>
    </div>
    <div class="insight-card">
      <div class="insight-label">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
        KI-Insight
      </div>
      <p>Du bereitest Punkte mit den Noppen überdurchschnittlich gut vor – <strong>74%</strong> erzwungene Fehler. Das Problem liegt im Moment danach: Wenn der Ball zum Abschluss kommt, fehlt die Routine für den Vorhandschlag. Das ist kein Technikproblem – das ist ein <strong>Erwartungsdruck-Problem</strong>. Du spürst "jetzt muss er rein" und genau das blockiert.</p>
    </div>
    <div style="height:28px"></div>
  </div>

  <!-- ════ NAV ════ -->
  <nav class="bottom-nav" id="bottom-nav" style="display:none">
    <div class="nav-item active" id="nav-home" onclick="goTo('screen-home')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      <div class="nav-label">Home</div>
    </div>
    <div class="nav-item" id="nav-mentor" onclick="goTo('screen-mentor')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.44-4.14Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.44-4.14Z"/></svg>
      <div class="nav-label">Mentor</div>
    </div>
    <div class="nav-item" id="nav-sound" onclick="goTo('screen-sound')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3"/></svg>
      <div class="nav-label">Sound</div>
    </div>
    <div class="nav-item" id="nav-analyse" onclick="goTo('screen-analyse')">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--muted)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/><line x1="2" y1="20" x2="22" y2="20"/></svg>
      <div class="nav-label">Analyse</div>
    </div>
  </nav>

</div>
<script>
// ── ONBOARDING ──
let currentStep = 0;
const totalSteps = 6;
let profile = { name:'', years:'', style:'', ttr:1200, material:[], weaknesses:[], goal:'' };

function nextStep(n) {
  document.getElementById('step-' + currentStep).classList.remove('active');
  document.getElementById('dot-' + currentStep).classList.remove('active');
  document.getElementById('dot-' + currentStep).classList.add('done');
  currentStep = n;
  document.getElementById('step-' + n).classList.add('active');
  document.getElementById('dot-' + n).classList.add('active');
  document.getElementById('stepCounter').textContent = (n+1) + ' / ' + totalSteps;
}

function checkStep0() {
  const name = document.getElementById('input-name').value.trim();
  const hasYears = document.querySelector('[data-group="years"].selected');
  document.getElementById('btn-0').disabled = !(name.length > 0);
  if(name) profile.name = name;
}

function selectOne(el, group) {
  el.closest('.option-grid').querySelectorAll('.option-btn').forEach(b => {
    b.classList.remove('selected');
    b.dataset.group = group;
  });
  el.classList.add('selected');
  el.dataset.group = group;
  if(group === 'style') profile.style = el.querySelector('.option-label').textContent;
  if(group === 'goal') profile.goal = el.querySelector('.option-label').textContent;
  if(group === 'years') { profile.years = el.querySelector('.option-label').textContent; document.getElementById('btn-0').disabled = document.getElementById('input-name').value.trim().length === 0; }
}

function toggleMulti(el, group) {
  el.classList.toggle('selected');
}

function updateTTR(val) {
  val = parseInt(val);
  profile.ttr = val;
  document.getElementById('ttrDisplay').textContent = val;
  let label = '';
  if(val < 900) label = 'Einsteiger · Hobbybereich';
  else if(val < 1200) label = 'Kreisliga · Solider Einsteiger';
  else if(val < 1500) label = 'Kreisklasse · Erfahrener Vereinsspieler';
  else if(val < 1700) label = 'Bezirksliga · Solider Vereinsspieler';
  else if(val < 1900) label = 'Verbandsliga · Guter Vereinsspieler';
  else if(val < 2100) label = 'Oberliga · Sehr guter Spieler';
  else if(val < 2300) label = 'Regionalliga · Spitzenspieler';
  else label = 'Bundesliga / Nationalklasse';
  document.getElementById('ttrClassLabel').textContent = label;
}

function cycleTag(el) {
  if(el.classList.contains('selected-strength')) {
    el.classList.remove('selected-strength');
    el.classList.add('selected-weakness');
  } else if(el.classList.contains('selected-weakness')) {
    el.classList.remove('selected-weakness');
  } else {
    el.classList.add('selected-strength');
  }
}

function finishOnboarding() {
  const nameVal = document.getElementById('input-name').value.trim() || 'Spieler';
  profile.name = nameVal;

  // Update home screen with profile data
  document.getElementById('home-greeting').textContent = 'Willkommen, ' + nameVal;
  document.getElementById('pill-avatar').textContent = nameVal.charAt(0).toUpperCase();
  document.getElementById('pill-name').textContent = nameVal;
  document.getElementById('pill-ttr').textContent = profile.ttr;

  document.getElementById('bottom-nav').style.display = 'flex';
  initChat();
  goTo('screen-home');
}

// ── NAVIGATION ──
const navMap = {'screen-home':'nav-home','screen-mentor':'nav-mentor','screen-sound':'nav-sound','screen-analyse':'nav-analyse'};

function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => {
    n.classList.remove('active');
    const svg = n.querySelector('svg');
    if(svg) svg.setAttribute('stroke','var(--muted)');
  });
  if(navMap[id]) {
    const navEl = document.getElementById(navMap[id]);
    navEl.classList.add('active');
    const svg = navEl.querySelector('svg');
    if(svg) svg.setAttribute('stroke','var(--accent)');
  }
  if(id === 'screen-analyse') setTimeout(animateBars, 250);
  if(id === 'screen-mentor') {
    const msgs = document.getElementById('chat-messages');
    if(msgs && msgs.children.length === 0) initChat();
  }
}

function animateBars() {
  document.querySelectorAll('.bar-fill').forEach(b => { b.style.width = b.dataset.w + '%'; });
}

function selectMood(el) {
  document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
}

// ── REAL AI MENTOR ──
let chatHistory = [];
let apiKey = localStorage.getItem('ft_api_key') || '';
function checkApiKey() {
  if (!apiKey) {
    const k = prompt('Bitte Anthropic API Key eingeben:');
    if (k && k.trim().startsWith('sk-')) { apiKey = k.trim(); localStorage.setItem('ft_api_key', apiKey); }
  }
}
let quickRepliesShown = true;

function buildSystemPrompt() {
  return `Du bist ein erfahrener Tischtennis-Mentalcoach und Sportpsychologe namens "Mentor" in der App "fünftersatz".

SPIELERPROFIL:
- Name: ${profile.name || 'Spieler'}
- Spieljahre: ${profile.years || 'unbekannt'}
- Spielstil: ${profile.style || 'Störspieler'}
- Material: ${(profile.material || ['Lange Noppe RH']).join(', ')}
- TTR: ${profile.ttr || 1520}
- Stärken: Störspiel, Noppen-Kontrolle, Konstanz
- Schwächen: VH-Abschluss nach Vorspiel, Routine bei Führung, Nervenstärke
- Ziel: ${profile.goal || 'Führungen ausbauen'}

DEINE ROLLE:
- Du kennst diesen Spieler und sein Profil in- und auswendig
- Du sprichst ihn direkt mit seinem Namen an (gelegentlich, nicht bei jeder Nachricht)
- Du gibst konkrete, sportpsychologisch fundierte Ratschläge
- Du beziehst dich auf sein spezifisches Material (lange Noppe, Störspiel) wenn relevant
- Du bist direkt, klar, empathisch – kein Blabla
- Antworte auf Deutsch, kurz und präzise (max 4-5 Sätze pro Antwort)
- Nutze gelegentlich **fettgedruckte** Schlüsselwörter für Betonung
- Gib am Ende einer Antwort manchmal eine konkrete kleine Übung oder Technik mit
- Du erinnerst dich an alles was im Gespräch gesagt wurde`;
}

function initChat() {
  const name = profile.name || 'Spieler';
  const welcomeText = `Hey ${name} – schön, dass du da bist.

Du spielst lange Noppe auf der Rückhand, bist Störspieler mit ${profile.ttr || 1520} TTR. Ich kenne dein Spiel – und ich weiß: Der **Vorhand-Abschluss nach gutem Vorspiel** kostet dich regelmäßig Punkte die du schon in der Tasche hattest.

Woran wollen wir heute arbeiten?`;
  appendMentorBubble(welcomeText);
}

function appendMentorBubble(text) {
  const feed = document.getElementById('chat-messages');
  const div = document.createElement('div');
  div.style.cssText = 'display:flex;gap:12px;align-items:flex-start;animation:fadeUp .3s ease;';
  const avatar = document.createElement('div');
  avatar.style.cssText = 'width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#7b6cff,#00e5a0);display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;';
  avatar.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.44-4.14Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.44-4.14Z"/></svg>';
  const bubble = document.createElement('div');
  bubble.style.cssText = 'background:#161a22;border:2px solid rgba(255,255,255,.07);border-radius:18px 18px 18px 4px;padding:18px 20px;font-size:15px;line-height:1.7;font-weight:300;flex:1;';
  // Convert **text** to bold
  bubble.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong style="color:var(--accent);font-weight:500;">$1</strong>').split('\n').join('<br>');
  div.appendChild(avatar);
  div.appendChild(bubble);
  feed.appendChild(div);
  feed.scrollTop = feed.scrollHeight;
}

function appendUserBubble(text) {
  const feed = document.getElementById('chat-messages');
  const div = document.createElement('div');
  div.style.cssText = 'display:flex;justify-content:flex-end;animation:fadeUp .3s ease;';
  const bubble = document.createElement('div');
  bubble.style.cssText = 'background:rgba(123,108,255,.12);border:2px solid rgba(123,108,255,.2);border-radius:18px 18px 4px 18px;padding:16px 20px;font-size:15px;line-height:1.6;max-width:80%;';
  bubble.textContent = text;
  div.appendChild(bubble);
  feed.appendChild(div);
  feed.scrollTop = feed.scrollHeight;
}

function appendTypingIndicator() {
  const feed = document.getElementById('chat-messages');
  const div = document.createElement('div');
  div.id = 'typing-indicator';
  div.style.cssText = 'display:flex;gap:12px;align-items:center;animation:fadeUp .3s ease;';
  div.innerHTML = `<div style="width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#7b6cff,#00e5a0);display:flex;align-items:center;justify-content:center;flex-shrink:0;">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96-.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.44-4.14Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96-.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.44-4.14Z"/></svg>
  </div>
  <div style="background:#161a22;border:2px solid rgba(255,255,255,.07);border-radius:18px 18px 18px 4px;padding:16px 20px;display:flex;gap:6px;align-items:center;">
    <div style="width:7px;height:7px;border-radius:50%;background:var(--accent3);animation:pulse 1.2s infinite;"></div>
    <div style="width:7px;height:7px;border-radius:50%;background:var(--accent3);animation:pulse 1.2s .2s infinite;"></div>
    <div style="width:7px;height:7px;border-radius:50%;background:var(--accent3);animation:pulse 1.2s .4s infinite;"></div>
  </div>`;
  feed.appendChild(div);
  feed.scrollTop = feed.scrollHeight;
}

async function sendMessage() {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if(!text) return;
  input.value = '';
  input.style.height = 'auto';
  doSend(text);
}

function sendQuick(text) {
  document.getElementById('quick-replies').style.display = 'none';
  quickRepliesShown = false;
  doSend(text);
}

async function doSend(text) {
  if (!apiKey) checkApiKey();
  appendUserBubble(text);
  chatHistory.push({ role: 'user', content: text });

  appendTypingIndicator();
  const feed = document.getElementById('chat-messages');
  feed.scrollTop = feed.scrollHeight;

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'x-api-key': apiKey, 'anthropic-version': '2023-06-01', 'anthropic-dangerous-direct-browser-access': 'true' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: buildSystemPrompt(),
        messages: chatHistory
      })
    });
    const data = await response.json();
    const reply = data.content?.[0]?.text || 'Entschuldigung, ich konnte keine Antwort generieren.';
    
    document.getElementById('typing-indicator')?.remove();
    appendMentorBubble(reply);
    chatHistory.push({ role: 'assistant', content: reply });
  } catch(e) {
    document.getElementById('typing-indicator')?.remove();
    appendMentorBubble('Verbindungsfehler – bitte versuche es nochmal.');
  }
}

function handleKey(e) {
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

// ── PLAYER ──
let playing = false, progress = 0, timer;
function togglePlay() {
  playing = !playing;
  const icon = document.getElementById('playIcon');
  if(playing) {
    icon.innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
  } else {
    icon.innerHTML = '<polygon points="5 3 19 12 5 21 5 3"/>';
  }
  document.querySelectorAll('.wave-bar').forEach(b => b.style.animationPlayState = playing ? 'running' : 'paused');
  if(playing) {
    timer = setInterval(() => {
      progress = Math.min(progress + 0.083, 100);
      document.getElementById('progressFill').style.width = progress + '%';
      const s = Math.round(progress*12), m = Math.floor(s/60), sec = s%60;
      document.getElementById('progressTime').textContent = m+':'+sec.toString().padStart(2,'0')+' / 20:00';
      if(progress>=100){clearInterval(timer);playing=false;icon.innerHTML='<polygon points="5 3 19 12 5 21 5 3"/>';}
    },300);
  } else { clearInterval(timer); }
}

function selectBeat(el,name,sub) {
  document.querySelectorAll('.beat-item').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('trackName').textContent=name;
  document.getElementById('trackSub').textContent=sub;
  progress=0;
  document.getElementById('progressFill').style.width='0%';
  document.getElementById('progressTime').textContent='0:00 / 20:00';
}

// ── AFFIRMATIONS ──
const affs = [
  '"ICH SPIELE DEN BALL – NICHT DAS ERGEBNIS."',
  '"JEDER PUNKT IST EIN NEUANFANG."',
  '"MEIN STÖRSPIEL IST MEINE STÄRKE."',
  '"ICH BLEIBE RUHIG WENN ES ZÄHLT."',
  '"ICH VERTRAUE MEINER ROUTINE."',
  '"DER NÄCHSTE PUNKT GEHÖRT MIR."'
];
let affIdx = 0;
function nextAff() {
  affIdx = (affIdx+1) % affs.length;
  const el = document.getElementById('affText');
  el.style.opacity='0';
  setTimeout(()=>{el.textContent=affs[affIdx];el.style.opacity='1';},250);
}

let rec = false;
function toggleRec() {
  rec = !rec;
  const btn = document.getElementById('recBtn');
  if(rec) {
    btn.innerHTML = btn.innerHTML.replace('Eigenen Satz einsprechen','Aufnahme stoppen');
    btn.classList.add('recording');
    document.getElementById('affText').textContent = 'Sprich deinen Satz...';
  } else {
    btn.innerHTML = btn.innerHTML.replace('Aufnahme stoppen','Eigenen Satz einsprechen');
    btn.classList.remove('recording');
    document.getElementById('affText').textContent = '"DEINE AUFNAHME GESPEICHERT ✓"';
  }
}
</script>
</body>
</html>
